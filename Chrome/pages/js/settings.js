var Settings=function(){this.isSafari=!1,this.isChrome=!1,this.isFirefox=!1,this.enabledColor="#4caf50",this.disabledColor="#f44336",this.category,this.name,this.active};Settings.prototype.getLink=function(t){return this.isChrome?chrome.extension.getURL(t):this.isSafari?safari.extension.baseURI+t:this.isFirefox?browser.extension.getURL(t):void 0},Settings.prototype.updateData=function(t,e){var a=this;a.isChrome?chrome.storage.sync.set({data:t},function(){e(t)}):a.isFirefox?browser.storage.sync.set({data:t}).then(function(){e(t)}):a.isSafari&&(safari.self.tab.dispatchMessage("data",{type:"setItem",item:t}),e(t))},Settings.prototype.updateDefaultData=function(t){var e="pages/data/settings.json";e=this.getLink(e);var a=this,s={};$.ajax({url:e,type:"get",dataType:"json",success:function(e){s=e,a.updateData(e.data,t)},error:function(e){t(e,s)}})},Settings.prototype.onChange=function(t,e,a){var s=this;s.category=t,s.name=e,s.active=a;var i=function(s,i){var n=i.data;n.hasOwnProperty(t)&&n[t].hasOwnProperty(e)&&(n[t][e].active=a),s.updateData(n,function(t){})};s.isSafari?(safari.self.tab.dispatchMessage("data",{type:"getItem"}),safari.self.addEventListener("message",function(t){"data"===t.name&&(null!==t.message?i(s,{data:t.message}):i(s,{}))},!1)):s.isChrome?chrome.storage.sync.get("data",function(t){i(s,t)}):this.isFirefox&&browser.storage.sync.get("data",function(t){i(s,t)})},Settings.prototype.prepareBlock=function(t){for(var e in t){var a,s,i,n,o=$("<div>").empty();for(var r in t[e])a=t[e][r].active?setting.enabledColor:setting.disabledColor,t[e][r].working?(i="",n=r,s=!1):(i="off",a="#777777",n="Unfortunately "+r+" "+e+" is not working",s=!0),o.append($("<div>",{class:"item col-md-2 col-xs-4 col-sm-4 "+i,title:n}).append($("<div>",{class:"logo"}).append($("<img>",{src:"./img/websites/"+e+"/"+r+i+".png",title:r}))).append($("<div>",{class:"switch",id:e+"_"+n+"_"+i}).append($("<label>").append("Disable").append($("<input >",{type:"checkbox",checked:t[e][r].active,disabled:s})).append($("<span>",{class:"lever"})).append("Enable"))).append($("<div>",{class:"status",style:"background-color:"+a+";"})));$("#"+e).html(o)}},Settings.prototype.useSyncData=function(t){var e=this,a=function(a){a.data?t(a.data):e.updateDefaultData(t)};e.isChrome?chrome.storage.sync.get("data",a):e.isFirefox?browser.storage.sync.get("data",a):e.isSafari&&(safari.self.tab.dispatchMessage("data",{type:"getItem"}),safari.self.addEventListener("message",function(t){"data"===t.name&&a(null!==t.message?{data:t.message}:{})},!1))},Settings.prototype.__init__=function(){-1!=navigator.userAgent.toLowerCase().indexOf("chrom")?this.isChrome=!0:-1!=navigator.userAgent.toLowerCase().indexOf("safari")?this.isSafari=!0:-1!=navigator.userAgent.toLowerCase().indexOf("firefox")&&(this.isFirefox=!0),this.useSyncData(this.prepareBlock)};var setting=new Settings;$(".items").on("click",".switch",function(){var t=$(this)[0].id.split("_"),e=t[0],a="off"!==t[2],s=t[1],i=$(this).children("label").children("input")[0],n=i.checked,o=$(this).next();n?$(o).css("background-color",setting.enabledColor):$(o).css("background-color",setting.disabledColor),a||$(o).css("background-color","#777777"),setting.onChange(e,s,n)}),setting.__init__();