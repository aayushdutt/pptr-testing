function getAllCurrencies(e){var o=[];for(var t in e)e[t].currency&&o.push(e[t].currency);return o.sort(),o=o.filter(function(e,o,t){return o==t.indexOf(e)})}var options={};options.isSafari=!1,-1==navigator.userAgent.toLowerCase().indexOf("chrom")&&-1!=navigator.userAgent.toLowerCase().indexOf("safari")&&(options.isSafari=!0,$("head,body").css("font-size","0.78em")),options.units={m:"kg",v:"L",d:"km",e:"kWh"},options.IMPGAL_TO_L=4.54609,options.USGAL_TO_L=3.785411784,options.MI_TO_KM=1.609344,options.KG_TO_LBS=2.204622621848775,options.saveOptions=function(){var e,o=parseFloat($("#distance-value").val()),t=parseFloat($("#fuel-value").val()),s=parseFloat($("#emission").val()),i=parseFloat($("#fuel-cost").val()),n=$("#currency-codes").val(),a=$("#last-checkup").val(),p=parseInt($("#next-checkup-year").val()),c=parseInt($("#next-checkup-month").val());parseFloat($("#cities").val());switch(options.data.set("co",s),options.data.set("currency",n),options.data.set("distance",o),options.data.set("fuel",t),options.data.set("fuelType",options.fType),options.data.set("unitSystem",$(".save>:checkbox:checked").attr("id")),options.data.set("inputType",$(".inputType>:checkbox:checked").attr("id")),options.data.set("units",options.units),options.data.set("inputSource",$(".tab>>:checkbox:checked").attr("id")),options.data.set("fuelCost",{value:i,curr:n}),options.data.set("emissionDisplayUnit",$("#emission-unit-mass").val()),options.data.get("inputSource")){case"by-fuel-consumption":if(o<=0||t<=0)return void options.showMessage("error","error");e=t/o,"uscustomary"!=options.data.get("unitSystem")&&"imperial"!=options.data.get("unitSystem")||("v"==options.fuels[options.fType].measuredBy?"uscustomary"==options.data.get("unitSystem")?e*=options.USGAL_TO_L/options.MI_TO_KM:e*=options.IMPGAL_TO_L/options.MI_TO_KM:"m"==options.fuels[options.fType].measuredBy?e/=options.MI_TO_KM*options.KG_TO_LBS:"e"==options.fuels[options.fType].measuredBy&&(e/=options.MI_TO_KM)),s=e*options.fuels[options.fType].CO2Emission;break;case"direct-co-emission":if(s<=0)return void options.showMessage("error","error");"uscustomary"!=options.data.get("unitSystem")&&"imperial"!=options.data.get("unitSystem")||(s/=options.KG_TO_LBS*options.MI_TO_KM),e=s/options.fuels[options.fType].CO2Emission}options.data.set("CO2emissionRate",s);var r=options.fuels[options.fType].CH4Emission*e;options.data.set("CH4emissionRate",r);var l=options.fuels[options.fType].N2OEmission*e;options.data.set("N2OemissionRate",l);var u=options.fuels[options.fType].GHGEmission*e;if(options.data.set("GHGemissionRate",u),options.data.set("consumptionRate",e),options.data.set("showTravelCost",document.getElementById("display-travel-cost").checked),options.data.get("showTravelCost")){if(i<=0)return void options.showMessage("error","error");options.data.set("travelRate",e*i)}if(options.data.set("showCheckupNotification",document.getElementById("display-checkup-notify").checked),options.data.get("showCheckupNotification")){var d=new Date(a),g=d.addMonths(c);g=d.addYears(p),options.data.set("lastCheckup",a),options.data.set("nextCheckupMonth",c),options.data.set("nextCheckupYear",p),options.setAlarm(g)}else browserServices.clearAlarm("CarCheckupAlarm");options.showMessage("saved","good"),options.storeData()},options.setAlarm=function(e){var o=Math.abs(new Date-e),t=Math.floor(o/1e3/60);browserServices.createAlarm("CarCheckupAlarm",{delayInMinutes:t,periodInMinutes:t})},options.getMessage=function(e){return options.messages[e].message},options.showMessage=function(e,o){var t=$("#message");if(options.isSafari)switch(o){case"error":t.html(options.getMessage(e)).css("display","block").css("background-color","#e74c3c");break;case"good":t.html(options.getMessage(e)).css("display","block").css("background-color","#27ae60"),setTimeout(function(){t.css("display","none")},1200)}else browserServices.getLocalisation(e,0,function(e,s){switch(o){case"error":t.html(e).css("display","block").css("background-color","#e74c3c");break;case"good":t.html(e).css("display","block").css("background-color","#27ae60"),setTimeout(function(){t.css("display","none")},1200)}})},options.storeData=function(){options.data.set("init",!0),options.data.store()},options.saveLocation=function(){var e={},o=new google.maps.Geocoder;navigator.geolocation.getCurrentPosition(function(t){var s=t.coords.latitude,i=t.coords.longitude,n=new google.maps.LatLng(s,i);o.geocode({latLng:n},function(o,t){for(var s=o[0].address_components,i=0;i<s.length;i++)"locality,political"!=s[i].types&&"administrative_area_level_1,political"!=s[i].types&&"country,political"!=s[i].types||(e[s[i].types[0]]=s[i].long_name,e[s[i].types[0]+"_short"]=s[i].short_name);$("#reLocation").css("pointer-events","auto"),$("#reLocation").css("animation","none"),options.data.set("geoData",e),options.data.set("renPer",{wiki:options.countries[options.data.get("geoData").country_short].RenewablePer}),$("#green-electricity input").val(options.data.get("renPer").wiki),$("#location").html((options.data.get("geoData").locality+", "+options.data.get("geoData").administrative_area_level_1+", "+options.data.get("geoData").country).replace(/ undefined,|undefined,/g,"")),options.data.set("currency",options.countries[options.data.get("geoData").country_short].currency),$("#currency-codes").val(options.data.get("currency")),options.checkFuelPrice(),options.data.store()})},function(e){options.data.set("geoData",null),$("#reLocation").css("pointer-events","auto"),$("#reLocation").css("animation","none"),$("#location").html("Unable to retrieve location"),$("#load-prices-button").prop("disabled",!0),options.data.set("currency","USD"),$("#currency-codes").val(options.data.get("currency"))})},options.loadFuelPrices=function(){var e=options.data.get("geoData");if(e){e=e.country_short;var o=options.settings.fuelPrices[e],t=options.settings.exchangeRates[$("#currency-codes").val()];t||(t=options.defaultRates.rates[$("#currency-codes").val()]),o&&("Diesel"==options.fType?$("#fuel-cost").val((o.diesel*t).toFixed(2)):"Gasoline"==options.fType||"Petrol"==options.fType?$("#fuel-cost").val((o.gasoline*t).toFixed(2)):"LPG"!=options.fType&&"CNG"!=options.fType||$("#fuel-cost").val((o.LPG*t).toFixed(2)))}},options.checkFuelPrice=function(){var e=options.data.get("geoData");if(!e)return void $("#load-prices-button").prop("disabled",!0);e=e.country_short;var o=options.settings.fuelPrices[e];o.gasoline&&(o.petrol=o.gasoline),o.LPG&&(o.CNG=o.LPG);for(var t in o)if(t.toLowerCase()==options.fType.toLowerCase())return void $("#load-prices-button").prop("disabled",!1);$("#load-prices-button").prop("disabled",!0)},options.loadSavedData=function(){options.data.get("geoData")?($("#green-electricity input").val(options.data.get("renPer").wiki),$("#location").html((options.data.get("geoData").locality+", "+options.data.get("geoData").administrative_area_level_1+", "+options.data.get("geoData").country).replace(/ undefined,|undefined,/g,"")),$("#reLocation").css("pointer-events","auto"),$("#reLocation").css("animation","none"),$("#currency-codes").val(options.data.get("currency"))):($("#reLocation").css("pointer-events","auto"),$("#reLocation").css("animation","none"),$("#location").html("Unable to retrieve location"),$("#load-prices-button").prop("disabled",!0),$("#currency-codes").val(options.data.get("currency"))),options.fType=$("#fuel-type").val(),options.data.has("init")&&($('[id="fuel-type"]').val(options.data.get("fuelType")),options.fType=$("#fuel-type").val(),options.checkFuelPrice(),$("#fuel-cost").val(options.data.get("fuelCost").value),$('[id="currency-codes"]').val(options.data.get("fuelCost").curr),$("#distance-value").val(options.data.get("distance")),$("#fuel-value").val(options.data.get("fuel")),$("#emission").val(options.data.get("co")),$("#last-checkup").val(options.data.get("lastCheckup")),$("#next-checkup-month").val(options.data.get("nextCheckupMonth")),$("#next-checkup-year").val(options.data.get("nextCheckupYear")),options.fType=$("#fuel-type").val(),options.data.get("showTravelCost")&&($("#display-travel-cost").attr("checked",!0),options.toggleTravelCost($("#display-travel-cost"))),options.data.get("showCheckupNotification")&&($("#display-checkup-notify").attr("checked",!0),options.toggleCheckupNotification($("#display-checkup-notify"))),$("#"+options.data.get("inputSource")).attr("checked",!0),options.toggleInputSource($("#"+options.data.get("inputSource"))),$("#"+options.data.get("unitSystem")).attr("checked",!0),options.toggleUnits($("#"+options.data.get("unitSystem"))),$("#currency-codes").val(options.data.get("currency")))},options.switchTab=function(e){$(".tab-button.selected").removeClass("selected"),e.addClass(" selected"),$(".tab.open").removeClass("open"),$(".tab:nth-child("+($(".tab-button.selected").index()+1)+")").addClass("open")},options.toggleInputSource=function(e){"by-fuel-consumption"===e.prop("id")&&(e.prop("checked")?($("#direct-co-emission").prop("checked",!1),$(".by-fuel input,.by-fuel select").prop("disabled",!1),$(".by-co input,.by-co select").prop("disabled",!0),options.data.has("init")?($("#"+options.data.get("inputType")).prop("checked",!0),options.toggleInputType($("#"+options.data.get("inputType")))):options.toggleInputType($(".inputType>:checkbox:checked")),$(".cost-fields :eq(0)").hide()):e.prop("checked",!0)),"direct-co-emission"===e.prop("id")&&(e.prop("checked")?($("#by-fuel-consumption").prop("checked",!1),$(".by-fuel input,.by-fuel select").prop("disabled",!0),$(".by-co input,.by-co select").prop("disabled",!1),$(".cost-fields :eq(0)").show()):e.prop("checked",!0))},options.toggleInputType=function(e){"fuel-efficiency"===e.prop("id")?e.prop("checked")?($("#fuel-value").val(1).prop("disabled",!0),$("#distance-value").prop("disabled",!1),$("#fuel-consumed-per").prop("checked",!1),$("#custom-values").prop("checked",!1),browserServices.getLocalisation("feMessage",0,function(e,o){options.isSafari?$("#usage-message").html(options.getMessage("feMessage")):$("#usage-message").html(e)})):e.prop("checked",!0):"fuel-consumed-per"===e.prop("id")?e.prop("checked")?($("#distance-value").val(100).prop("disabled",!0),$("#fuel-value").prop("disabled",!1),$("#fuel-efficiency").prop("checked",!1),$("#custom-values").prop("checked",!1),browserServices.getLocalisation("fcpMessage",0,function(e,o){options.isSafari?$("#usage-message").html(options.getMessage("fcpMessage")):$("#usage-message").html(e)})):e.prop("checked",!0):e.prop("checked")?($("#distance-value").prop("disabled",!1),$("#fuel-value").prop("disabled",!1),$("#fuel-consumed-per").prop("checked",!1),$("#fuel-efficiency").prop("checked",!1),browserServices.getLocalisation("cvMessage",0,function(e,o){options.isSafari?$("#usage-message").html(options.getMessage("cvMessage")):$("#usage-message").html(e)})):e.prop("checked",!0)},options.toggleTravelCost=function(e){e.prop("checked")?$(".cost-fields select,.cost-fields input").prop("disabled",!1):$(".cost-fields select,.cost-fields input").prop("disabled",!0)},options.toggleCheckupNotification=function(e){e.prop("checked")?$("#last-checkup,#next-checkup input").prop("disabled",!1):$("#last-checkup,#next-checkup input").prop("disabled",!0)},options.toggleUnits=function(e){"metric"===e.prop("id")?(options.units.m="kg",options.units.v="L",options.units.d="km",e.prop("checked")?$("#uscustomary,#imperial").prop("checked",!1):e.prop("checked",!0)):e.prop("checked")?(options.units.m="lbs",options.units.v="gal",options.units.d="mi",$("#metric").prop("checked",!1),"uscustomary"===e.prop("id")?$("#imperial").prop("checked",!1):$("#uscustomary").prop("checked",!1)):e.prop("checked",!0),$('[id="distance-unit"]').val(options.units.d).html(options.units.d),$("#mass-unit").val(options.units.m).html(options.units.m),$('[id="fuel-unit"]').val(options.units[options.fuels[options.fType].measuredBy]).html(options.units[options.fuels[options.fType].measuredBy]),"e"==options.fuels[options.fType].measuredBy?$("#green-electricity").show():$("#green-electricity").hide()},options.mirrorFuelValues=function(e){options.fType=$(e).val(),$('[id="fuel-type"]').val(options.fType),options.toggleUnits($(".save>:checkbox:checked"))},options.mirrorCurrency=function(e){$('[id="currency-codes"]').val(e.prop("value"))},options.loadResources=function(){$.ajaxSetup({beforeSend:function(e){e.overrideMimeType&&e.overrideMimeType("application/json")}});var e;try{e=/(\w*)-/.exec(navigator.language)[1]}catch(o){e="en"}$.when($.getJSON(browserServices.getFilePath("/_locales/"+e+"/messages.json"),function(e){options.messages=e}).fail(function(){$.getJSON(browserServices.getFilePath("/_locales/en/messages.json"),function(e){options.messages=e})}),$.getJSON(browserServices.getFilePath("/core/resources/fuels.json"),function(e){options.fuels=e}),$.getJSON(browserServices.getFilePath("/core/resources/currencyCodes.json"),function(e){options.currencyCodes=e.currencyCodes}),$.getJSON(browserServices.getFilePath("/core/resources/countries.json"),function(e){options.countries=e}),$.getJSON(browserServices.getFilePath("/core/resources/exchangeRates.json"),function(e){options.defaultRates=e})).then(function(){!0===options.fuelsinit&&!0===options.currencyCodesinit&&!0===options.countriesinit&&!0===options.messagesinit&&options.data.has("geoData")&&!options.firstRun?(options.populateMenus(),options.loadMessages(),options.loadSavedData()):(options.firstRun=!1,options.populateMenus(),options.loadMessages(),options.loadSavedData()),options.populated=!0}),$.getScript("https://maps.googleapis.com/maps/api/js").done(function(){options.data.has("geoData")||options.saveLocation()})},options.listeners=function(){$("#save-button").on("click",function(){options.saveOptions()}),$(".tab-button").on("click",function(){options.switchTab($(this))}),$("#by-fuel-consumption,#direct-co-emission").on("click",function(){options.toggleInputSource($(this))}),$("#fuel-efficiency,#fuel-consumed-per,#custom-values").on("click",function(){options.toggleInputType($(this))}),$("#display-travel-cost").on("click",function(){options.toggleTravelCost($(this))}),$("#display-checkup-notify").on("click",function(){options.toggleCheckupNotification($(this))}),$("#metric,#uscustomary,#imperial").on("click",function(){options.toggleUnits($(this))}),$("#reLocation").on("click",function(){options.saveLocation()}),$('[id="fuel-type"]').on("change",function(){options.mirrorFuelValues($(this)),options.checkFuelPrice()}),$("#currency-codes").on("change",function(){options.mirrorCurrency($(this))}),$("#load-prices-button").on("click",function(){options.loadFuelPrices()}),$("#distance-value,#emission,#fuel-value,#fuel-cost").on("keypress",function(e){45===e.which&&e.preventDefault()})},options.initStorageManager=function(e){options.data=new StorageManager("calculationObject",function(){e()})},options.initSettings=function(e){options.isSafari?(options.settings={},safari.self.tab.dispatchMessage("fuelPrices",{type:"getItem"}),safari.self.tab.dispatchMessage("exchangeRates",{type:"getItem"}),safari.self.addEventListener("message",function(e){"exchangeRates"===e.name?null!==e.message&&(options.settings.exchangeRates=e.message.rates):"fuelPrices"===e.name&&null!==e.message&&(options.settings.fuelPrices=e.message)},!1)):options.settings=new BackgroundDataAdapter(function(){}),e()},options.populateMenus=function(){var e;for(e in options.fuels)$('[id="fuel-type"]').append($("<option></option>").val(e).attr("data-language",options.fuels[e].langKey));var o=getAllCurrencies(options.countries);for(e=0;e<o.length;e++)$("#currency-codes").append($("<option></option>").val(o[e]).html(o[e]))},options.loadMessages=function(){var e;for(e=0;e<$("[data-language]").length;e++)options.isSafari?$($("[data-language]")[e]).html(options.getMessage($($("[data-language]")[e]).data("language"))):browserServices.getLocalisation($($("[data-language]")[e]).data("language"),e,function(e,o){$($("[data-language]")[o]).html(e)})},$(document).on("DOMContentLoaded",function(){options.listeners()}),$(document).ajaxComplete(function(e,o,t){null!==/\w\/(\w*)\.json/.exec(t.url)&&(options[/\w\/(\w*)\./.exec(t.url)[1]+"init"]=!0),null!==/maps.googleapis.com/.exec(t.url)&&(options.mapsAPIloaded=!0),!0!==options.fuelsinit||!0!==options.currencyCodesinit||!0!==options.countriesinit||!0!==options.messagesinit||!0!==options.mapsAPIloaded||options.populated||(options.populated=!0,options.populateMenus(),options.loadMessages(),options.loadSavedData())}),options.initStorageManager(function(){options.initSettings(function(){options.loadResources()})});